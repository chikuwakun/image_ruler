import{d as Pe,r as Q,c as ce,a as ge,b as L,o as S,e as t,F as ve,f as Ce,g as ee,i as ue,u as w,n as ye,j as Se,k as Te,l as J,t as E,w as fe,m as re,p as Ae,q as Ee,s as xe,v as Le,x as De,y as $e}from"./vue-vendor-CmuGMDf3.js";import{U as Be,Z as Xe,H as Ye,R as Oe,S as _e,M as He,P as We,a as ze,C as Ne,T as Me,I as Fe,X as qe}from"./ui-vendor-Cv56dhD7.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))I(f);new MutationObserver(f=>{for(const R of f)if(R.type==="childList")for(const z of R.addedNodes)z.tagName==="LINK"&&z.rel==="modulepreload"&&I(z)}).observe(document,{childList:!0,subtree:!0});function a(f){const R={};return f.integrity&&(R.integrity=f.integrity),f.referrerPolicy&&(R.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?R.credentials="include":f.crossOrigin==="anonymous"?R.credentials="omit":R.credentials="same-origin",R}function I(f){if(f.ep)return;f.ep=!0;const R=a(f);fetch(f.href,R)}})();var j=(k=>(k.IDLE="idle",k.RULER_CREATION="ruler_creation",k.RULER_EDITING="ruler_editing",k.RULER_SELECTED="ruler_selected",k.COMPARISON="comparison",k.IMAGE_MANIPULATION="image_manipulation",k))(j||{});const be=Pe("app",()=>{const k=Q("hand"),e=Q({mode:j.IDLE,selectedRuler:null,comparisonRulers:[],isDragging:!1,dragType:null}),a=Q([]),I=Q(null),f=Q([]),R=Q(null),z=Q({file:null,src:"",width:0,height:0,scale:1,offsetX:0,offsetY:0}),N=n=>{e.value.mode=n,n!==j.COMPARISON&&(e.value.comparisonRulers=[],a.value.forEach(c=>{c.isCompareSelected=!1})),n!==j.RULER_SELECTED&&(e.value.selectedRuler=null,I.value=null,a.value.forEach(c=>{c.isSelected=!1}))},H=(n,c=null)=>{e.value.isDragging=n,e.value.dragType=c,n&&c==="create"&&N(j.RULER_CREATION)},Y=()=>e.value.isDragging?e.value.dragType==="create"?j.RULER_CREATION:j.RULER_EDITING:e.value.comparisonRulers.length>0?j.COMPARISON:e.value.selectedRuler?j.RULER_SELECTED:j.IDLE,U=n=>{k.value=n,I.value=null,a.value.forEach(c=>{c.isSelected=!1,n!=="compare"&&(c.isCompareSelected=!1)})},te=n=>{a.value.push(n)},b=n=>{var M;const c=a.value.findIndex(A=>A.id===n);c!==-1&&(a.value.splice(c,1),((M=I.value)==null?void 0:M.id)===n&&(I.value=null),g(n))},g=n=>{f.value=f.value.filter(c=>c.rulerA.id!==n&&c.rulerB.id!==n)},h=n=>{a.value.forEach(c=>{c.isSelected=c.id===n}),I.value=a.value.find(c=>c.id===n)||null,R.value=null,e.value.selectedRuler=n,N(j.RULER_SELECTED)},v=(n,c)=>{var A;const M=a.value.findIndex(X=>X.id===n);M!==-1&&(a.value[M]={...a.value[M],...c},((A=I.value)==null?void 0:A.id)===n&&(I.value=a.value[M]),(c.startPoint||c.endPoint||c.length||c.angle)&&P(n))},y=()=>{a.value.forEach(n=>{n.isSelected=!1}),I.value=null,e.value.selectedRuler=null,e.value.comparisonRulers.length===0&&N(j.IDLE)},F=n=>{const c=a.value.find(A=>A.id===n);if(!c)return;const M=$.value.length;c.isCompareSelected?(c.isCompareSelected=!1,e.value.comparisonRulers=e.value.comparisonRulers.filter(A=>A!==n)):M<2&&(c.isCompareSelected=!0,e.value.comparisonRulers.push(n)),e.value.comparisonRulers.length>0?N(j.COMPARISON):N(j.IDLE),e.value.comparisonRulers.length===2&&K()},T=n=>{if(e.value.comparisonRulers.length===1){if(e.value.comparisonRulers[0]!==n)return F(n),!0}else F(n);return!1},K=()=>{const n=$.value;if(n.length!==2)return;const c=n[0],M=n[1],A=c.length/M.length,{simpleRatio:X,actualRatio:le}=s(A),Z={id:Date.now().toString(),rulerA:{...c},rulerB:{...M},simpleRatio:X,actualRatio:le,ratio:A,color:se(f.value.length),createdAt:Date.now()};f.value.push(Z)},q=n=>{z.value={...z.value,...n}},se=n=>{const c=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#FFA07A","#B19CD9","#FFB6C1"];return c[n%c.length]},s=n=>{let c=1,M=1,A=Math.abs(n-1);for(let p=1;p<=10;p++)for(let u=1;u<=10;u++)if((p+u)%2===0||(p+u)%3===0){const _=p/u,O=Math.abs(n-_);O<A&&(A=O,c=p,M=u)}const X=(p,u)=>{for(;u!==0;){const _=u;u=p%u,p=_}return p},le=c/X(c,M),Z=M/X(c,M),he=Z*n,i=Z,d=he%1===0?he.toString():he.toFixed(2),C=i%1===0?i.toString():i.toFixed(2);return{simpleRatio:`${le}:${Z}`,actualRatio:`${d}:${C}`}},o=()=>{const n=$.value;if(n.length!==2)return;const c=n[0],M=n[1],A=c.length/M.length,{simpleRatio:X,actualRatio:le}=s(A),Z={id:Date.now().toString(),rulerA:{...c},rulerB:{...M},simpleRatio:X,actualRatio:le,ratio:A,color:se(f.value.length),createdAt:Date.now()};f.value.push(Z)},l=n=>{const c=f.value.findIndex(M=>M.id===n);c!==-1&&f.value.splice(c,1)},m=n=>{const c=f.value.find(X=>X.id===n);if(!c)return;U("compare"),a.value.forEach(X=>{X.isCompareSelected=!1});const M=a.value.find(X=>X.id===c.rulerA.id),A=a.value.find(X=>X.id===c.rulerB.id);M&&(M.isCompareSelected=!0),A&&(A.isCompareSelected=!0)},r=n=>{R.value===n?R.value=null:R.value=n},x=()=>{R.value=null},D=()=>{a.value.forEach(n=>{n.isCompareSelected=!1}),e.value.comparisonRulers=[],N(j.IDLE)},P=n=>{f.value.forEach(c=>{if(c.rulerA.id===n||c.rulerB.id===n){const M=a.value.find(X=>X.id===c.rulerA.id),A=a.value.find(X=>X.id===c.rulerB.id);if(M&&A){const X=M.length/A.length,{simpleRatio:le,actualRatio:Z}=s(X);c.rulerA={...M},c.rulerB={...A},c.ratio=X,c.simpleRatio=le,c.actualRatio=Z}}})},$=ce(()=>a.value.filter(n=>n.isCompareSelected)),B=ce(()=>z.value.src!==""),W=ce(()=>n=>f.value.filter(c=>c.rulerA.id===n||c.rulerB.id===n)),G=ce(()=>Y()),ne=ce(()=>G.value===j.COMPARISON),de=ce(()=>G.value===j.IDLE&&B.value),me=ce(()=>{if(!R.value)return[];const n=f.value.find(c=>c.id===R.value);return n?[n.rulerA.id,n.rulerB.id]:[]});return{currentTool:k,interactionContext:e,rulers:a,selectedRuler:I,lockedRatios:f,selectedHistoryId:R,image:z,setContextMode:N,setDragState:H,determineContext:Y,startInstantComparison:T,autoSaveComparison:K,setCurrentTool:U,addRuler:te,removeRuler:b,removeRelatedHistory:g,selectRuler:h,clearSelection:y,toggleCompareSelection:F,updateRuler:v,setImageData:q,lockCurrentComparison:o,removeLock:l,selectLockForComparison:m,selectHistory:r,clearHistorySelection:x,clearComparisonState:D,calculateSimpleRatio:s,compareRulers:$,hasImage:B,getLocksForRuler:W,currentContextMode:G,isInComparisonMode:ne,canCreateRuler:de,highlightedRulerIds:me}}),Ue={class:"bg-gray-800 border-b border-gray-700 p-4"},Ve={class:"flex items-center space-x-2"},je={class:"flex space-x-1"},Ke=["data-tool","onClick","title"],Ge=ge({__name:"ToolBar",setup(k){const e=be(),a=Q(),I=[{type:"zoom",name:"拡大縮小",icon:Xe},{type:"hand",name:"ハンド",icon:Ye},{type:"ruler",name:"定規",icon:Oe},{type:"compare",name:"比較",icon:_e},{type:"select",name:"選択",icon:He}],f=()=>{var z;(z=a.value)==null||z.click()},R=z=>{var Y;const H=(Y=z.target.files)==null?void 0:Y[0];if(H&&H.type.startsWith("image/")){const U=new FileReader;U.onload=te=>{var h;const b=(h=te.target)==null?void 0:h.result,g=new Image;g.onload=()=>{e.setImageData({file:H,src:b,width:g.width,height:g.height,scale:1,offsetX:0,offsetY:0})},g.src=b},U.readAsDataURL(H)}};return(z,N)=>(S(),L("div",Ue,[t("div",Ve,[t("div",je,[(S(),L(ve,null,Ce(I,H=>t("button",{key:H.type,class:ye(["toolbar-button",{active:w(e).currentTool===H.type}]),"data-tool":H.type,onClick:Y=>w(e).setCurrentTool(H.type),title:H.name},[(S(),Se(Te(H.icon),{size:20}))],10,Ke)),64))]),N[1]||(N[1]=t("div",{class:"h-6 w-px bg-gray-600 mx-4"},null,-1)),t("input",{ref_key:"fileInput",ref:a,type:"file",accept:"image/*",class:"hidden",onChange:R},null,544),t("button",{class:"btn-primary flex items-center",onClick:f},[ee(w(Be),{size:16,class:"mr-2"}),N[0]||(N[0]=ue(" 画像を開く "))])])]))}});function Ze(){const k=Q(null);let e=null;const a=s=>{if(k.value=s,e=s.getContext("2d"),!e)throw new Error("Canvas context not available");I(s)},I=s=>{const o=e,l=s.getBoundingClientRect(),m=window.devicePixelRatio||1;s.width=l.width*m,s.height=l.height*m,s.style.width=l.width+"px",s.style.height=l.height+"px",o.scale(m,m)},f=()=>{!e||!k.value||e.clearRect(0,0,k.value.clientWidth,k.value.clientHeight)},R=(s,o)=>{!e||!k.value||(f(),e.save(),e.translate(o.offsetX,o.offsetY),e.scale(o.scale,o.scale),e.drawImage(s,0,0),e.restore())},z=(s,o,l=[],m=[])=>{!e||!k.value||s.forEach(r=>{N(r,o,l,m)})},N=(s,o,l=[],m=[])=>{if(!e)return;e.save();const r=h(s.startPoint,o),x=h(s.endPoint,o),D={x:(r.x+x.x)/2,y:(r.y+x.y)/2};e.strokeStyle=s.color,e.lineWidth=s.isSelected?4:3,e.lineCap="round",e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(x.x,x.y),e.stroke(),m.includes(s.id)&&se(s,r,x);const P=Math.atan2(x.y-r.y,x.x-r.x),$=P+Math.PI/2;Y(r,x,$,s.divisions||4);const B=12;e.fillStyle=s.color,U(r,P,s.isSelected,B),U(x,P+Math.PI,s.isSelected,B),s.isSelected&&(e.strokeStyle="#0066ff",e.lineWidth=1,e.setLineDash([5,5]),e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(x.x,x.y),e.stroke(),e.setLineDash([]),b(D,P,s,l)),s.isCompareSelected&&(e.strokeStyle="#ff6600",e.lineWidth=1,e.setLineDash([3,3]),e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(x.x,x.y),e.stroke(),e.setLineDash([])),v(s,r,x,o,l),e.restore()},H=(s,o,l,m=!1)=>{var $;if(!e)return;const r={x:s.x+Math.cos(o)*l/2,y:s.y+Math.sin(o)*l/2},x={x:s.x-Math.cos(o)*l/2,y:s.y-Math.sin(o)*l/2};e.save();const D=(($=e.fillStyle)==null?void 0:$.toString())||"#0066ff",P=g(D,.3);e.strokeStyle=P,e.lineWidth=m?3:2,e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(x.x,x.y),e.stroke(),e.restore()},Y=(s,o,l,m)=>{if(e)for(let r=1;r<m;r++){const x=r/m,D={x:s.x+(o.x-s.x)*x,y:s.y+(o.y-s.y)*x},P=r===m/2,$=r===m/4||r===3*m/4;let B,W;P&&m%2===0?(B=12,W=!0):$&&m>=4?(B=9,W=!1):(B=7,W=!1),H(D,l,B,W)}},U=(s,o,l,m=12)=>{var W;if(!e)return;const r=l?m+2:m,x=o+Math.PI/2,D={x:s.x+Math.cos(x)*r/2,y:s.y+Math.sin(x)*r/2},P={x:s.x-Math.cos(x)*r/2,y:s.y-Math.sin(x)*r/2};e.save();const $=((W=e.fillStyle)==null?void 0:W.toString())||"#0066ff",B=g($,.2);e.strokeStyle=B,e.lineWidth=l?4:3,e.beginPath(),e.moveTo(D.x,D.y),e.lineTo(P.x,P.y),e.stroke(),l&&(e.strokeStyle="#ffffff",e.lineWidth=1,e.beginPath(),e.moveTo(D.x,D.y),e.lineTo(P.x,P.y),e.stroke()),e.restore()},te=(s,o,l)=>{if(!e)return;e.save();const m=h(s,l),r=h(o,l);e.strokeStyle="#0052cc",e.lineWidth=3,e.lineCap="round",e.setLineDash([5,5]),e.beginPath(),e.moveTo(m.x,m.y),e.lineTo(r.x,r.y),e.stroke();const x=Math.atan2(r.y-m.y,r.x-m.x),D=x+Math.PI/2;e.setLineDash([]),Y(m,r,D,4);const P=12;e.fillStyle="#0052cc",U(m,x,!1,P),U(r,x+Math.PI,!1,P),e.restore()},b=(s,o,l,m)=>{if(!e)return;const r=m.some(de=>de.rulerA.id===l.id||de.rulerB.id===l.id),x=o+Math.PI/2,D=30,P=r?1:-1,$=s.x+Math.cos(x)*D*P,B=s.y+Math.sin(x)*D*P;e.save(),e.strokeStyle="#0066ff",e.lineWidth=1,e.setLineDash([3,3]),e.beginPath(),e.moveTo(s.x,s.y),e.lineTo($,B),e.stroke(),e.setLineDash([]),e.fillStyle="#0066ff",e.strokeStyle="#ffffff",e.lineWidth=2,e.beginPath(),e.arc($,B,8,0,Math.PI*2),e.fill(),e.stroke(),e.strokeStyle="#ffffff",e.lineWidth=1.5,e.lineCap="round";const W=4;e.beginPath(),e.arc($,B,W,-Math.PI/4,Math.PI/4),e.stroke();const G=$+Math.cos(Math.PI/4)*W,ne=B+Math.sin(Math.PI/4)*W;e.beginPath(),e.moveTo(G,ne),e.lineTo(G-2,ne-2),e.moveTo(G,ne),e.lineTo(G-2,ne+2),e.stroke(),e.restore()},g=(s,o)=>{const l=s.replace("#",""),m=parseInt(l.substr(0,2),16),r=parseInt(l.substr(2,2),16),x=parseInt(l.substr(4,2),16),D=Math.round(m*(1-o)),P=Math.round(r*(1-o)),$=Math.round(x*(1-o));return`#${D.toString(16).padStart(2,"0")}${P.toString(16).padStart(2,"0")}${$.toString(16).padStart(2,"0")}`},h=(s,o)=>({x:s.x*o.scale+o.offsetX,y:s.y*o.scale+o.offsetY}),v=(s,o,l,m,r)=>{if(!e)return;const x=r.filter(n=>n.rulerA.id===s.id||n.rulerB.id===s.id);if(x.length===0)return;const D=(o.x+l.x)/2,P=(o.y+l.y)/2,B=Math.atan2(l.y-o.y,l.x-o.x)+Math.PI/2,W=m.scale,G=Math.max(25,15*W),ne=Math.max(20,12*W),me=s.isSelected?-1:1;x.forEach((n,c)=>{const M=(G+c*ne)*me,A=D+Math.cos(B)*M,X=P+Math.sin(B)*M,Z=n.rulerA.id===s.id?n.simpleRatio.split(":")[0]:n.simpleRatio.split(":")[1];y(A,X,Z,n.color,W)})},y=(s,o,l,m,r=1)=>{if(!e)return;e.save();const x=Math.max(12,Math.min(20,14*r));e.font=`600 ${x}px -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif`;const D=e.measureText(l),P=Math.max(6,4*r),$=Math.max(3,2*r),B=D.width+P*2,W=x+$*2,G=Math.max(3,2*r),ne=K(m,.3);e.fillStyle=ne,F(s-B/2,o-W/2,B,W,G),e.strokeStyle="rgba(255, 255, 255, 0.1)",e.lineWidth=Math.max(1,r*.5),T(s-B/2,o-W/2,B,W,G),e.fillStyle="#ffffff",e.textAlign="center",e.textBaseline="middle",e.fillText(l,s,o),e.restore()},F=(s,o,l,m,r)=>{e&&(e.beginPath(),e.moveTo(s+r,o),e.lineTo(s+l-r,o),e.quadraticCurveTo(s+l,o,s+l,o+r),e.lineTo(s+l,o+m-r),e.quadraticCurveTo(s+l,o+m,s+l-r,o+m),e.lineTo(s+r,o+m),e.quadraticCurveTo(s,o+m,s,o+m-r),e.lineTo(s,o+r),e.quadraticCurveTo(s,o,s+r,o),e.closePath(),e.fill())},T=(s,o,l,m,r)=>{e&&(e.beginPath(),e.moveTo(s+r,o),e.lineTo(s+l-r,o),e.quadraticCurveTo(s+l,o,s+l,o+r),e.lineTo(s+l,o+m-r),e.quadraticCurveTo(s+l,o+m,s+l-r,o+m),e.lineTo(s+r,o+m),e.quadraticCurveTo(s,o+m,s,o+m-r),e.lineTo(s,o+r),e.quadraticCurveTo(s,o,s+r,o),e.closePath(),e.stroke())},K=(s,o)=>{const l=s.replace("#",""),m=parseInt(l.substr(0,2),16),r=parseInt(l.substr(2,2),16),x=parseInt(l.substr(4,2),16),D=Math.round(m*(1-o)),P=Math.round(r*(1-o)),$=Math.round(x*(1-o));return`#${D.toString(16).padStart(2,"0")}${P.toString(16).padStart(2,"0")}${$.toString(16).padStart(2,"0")}`},q=()=>e,se=(s,o,l)=>{e&&(e.save(),e.lineCap="round",e.lineJoin="round",e.shadowColor="#fbbf24",e.shadowBlur=12,e.shadowOffsetX=0,e.shadowOffsetY=0,e.strokeStyle="#fbbf24",e.lineWidth=6,e.globalAlpha=.6,e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(l.x,l.y),e.stroke(),e.shadowColor="rgba(0, 0, 0, 0.5)",e.shadowBlur=8,e.shadowOffsetX=2,e.shadowOffsetY=2,e.strokeStyle=s.color,e.lineWidth=3,e.globalAlpha=1,e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(l.x,l.y),e.stroke(),e.shadowColor="transparent",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.strokeStyle="#ffffff",e.lineWidth=1,e.globalAlpha=.8,e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(l.x,l.y),e.stroke(),e.restore())};return{canvasRef:k,setupCanvas:a,clearCanvas:f,drawImage:R,drawRulers:z,drawRuler:N,drawTemporaryRuler:te,imageToDisplay:h,getContext:q}}const Je=k=>["#0066ff","#00cc66","#ff6600","#cc00cc","#ffcc00","#ff0066","#6600ff","#00ccff","#ff3300"][k-2],Qe=2,et=10,tt={key:0,class:"comparison-wizard fixed top-16 z-50",style:{right:"280px"}},st={class:"bg-gray-800/95 backdrop-blur-sm border border-gray-600 rounded-lg shadow-xl px-3 py-2 max-w-xs"},ot={class:"text-blue-200 text-xs"},nt=ge({__name:"ComparisonWizard",setup(k){const e=be(),a=ce(()=>e.isInComparisonMode&&I.value<3),I=ce(()=>{const R=e.compareRulers.length;return R===0?1:R===1?2:R===2?3:1}),f=()=>{switch(I.value){case 1:return"比較したい1つ目の定規をクリックしてください";case 2:return"2つ目の定規をクリックしてください";case 3:return"比較完了！結果は自動的に履歴に保存されます。";default:return""}};return(R,z)=>a.value?(S(),L("div",tt,[t("div",st,[t("div",ot,E(f()),1)])])):J("",!0)}}),Ie=(k,e)=>{const a=k.__vccOpts||k;for(const[I,f]of e)a[I]=f;return a},at=Ie(nt,[["__scopeId","data-v-93a14803"]]),rt={class:"px-3 py-2 border-b border-gray-700"},lt={class:"flex items-center space-x-2"},it={class:"text-sm font-medium text-gray-200"},ct={class:"py-1"},dt={class:"relative"},ut={class:"grid grid-cols-6 gap-2"},ft=["onClick","title"],gt={class:"mt-3 pt-2 border-t border-gray-700"},mt=["value"],ht=ge({__name:"RulerContextMenu",props:{ruler:{},position:{},isVisible:{type:Boolean}},emits:["edit","compare","changeColor","delete","close"],setup(k,{emit:e}){const a=k,I=e,f=Q(!1),R=["#ff0000","#ff8800","#ffff00","#88ff00","#00ff00","#00ff88","#00ffff","#0088ff","#0000ff","#8800ff","#ff00ff","#ff0088","#ffffff","#cccccc","#888888","#444444","#000000","#8b4513"],z=ce(()=>{if(!a.position||!a.isVisible)return{display:"none"};const v=192,y=280;let F=a.position.x,T=a.position.y;return F+v>window.innerWidth&&(F=window.innerWidth-v-10),T+y>window.innerHeight&&(T=window.innerHeight-y-10),F=Math.max(10,F),T=Math.max(10,T),{left:`${F}px`,top:`${T}px`,position:"fixed",zIndex:50}}),N=()=>{a.ruler&&I("edit",a.ruler.id),h()},H=()=>{a.ruler&&I("compare",a.ruler.id),h()},Y=()=>{f.value=!f.value},U=v=>{a.ruler&&I("changeColor",a.ruler.id,v),f.value=!1,h()},te=v=>{const y=v.target;a.ruler&&y.value&&I("changeColor",a.ruler.id,y.value),f.value=!1,h()},b=v=>({"#ff0000":"赤","#ff8800":"オレンジ","#ffff00":"黄色","#88ff00":"黄緑","#00ff00":"緑","#00ff88":"青緑","#00ffff":"シアン","#0088ff":"水色","#0000ff":"青","#8800ff":"紫","#ff00ff":"マゼンタ","#ff0088":"ピンク","#ffffff":"白","#cccccc":"薄灰","#888888":"灰色","#444444":"濃灰","#000000":"黒","#8b4513":"茶色"})[v]||v,g=()=>{a.ruler&&I("delete",a.ruler.id),h()},h=()=>{f.value=!1,I("close")};return(v,y)=>{var F,T,K;return S(),L(ve,null,[v.isVisible?(S(),L("div",{key:0,class:"ruler-context-menu fixed z-50 bg-gray-800 border border-gray-600 rounded-lg shadow-xl py-2 min-w-48",style:re(z.value),onClick:y[1]||(y[1]=fe(()=>{},["stop"]))},[t("div",rt,[t("div",lt,[t("div",{class:"w-3 h-3 rounded",style:re({backgroundColor:(F=v.ruler)==null?void 0:F.color})},null,4),t("span",it," 定規 ("+E(Math.round(((T=v.ruler)==null?void 0:T.length)||0))+"px) ",1)])]),t("div",ct,[t("button",{onClick:N,class:"context-menu-item"},[ee(w(We),{size:16}),y[2]||(y[2]=t("span",null,"この定規を編集",-1)),y[3]||(y[3]=t("span",{class:"text-xs text-gray-500 ml-auto"},"端点ドラッグで調整",-1))]),t("button",{onClick:H,class:"context-menu-item"},[ee(w(_e),{size:16}),y[4]||(y[4]=t("span",null,"他の定規と比較",-1)),y[5]||(y[5]=t("span",{class:"text-xs text-gray-500 ml-auto"},"Ctrl+クリック",-1))]),t("div",dt,[t("button",{onClick:Y,class:"context-menu-item"},[ee(w(ze),{size:16}),y[6]||(y[6]=t("span",null,"色を変更",-1)),ee(w(Ne),{size:14,class:"ml-auto"})]),f.value?(S(),L("div",{key:0,class:"absolute left-full top-0 ml-1 bg-gray-800 border border-gray-600 rounded-lg shadow-xl p-3 min-w-48",onClick:y[0]||(y[0]=fe(()=>{},["stop"]))},[y[8]||(y[8]=t("div",{class:"text-xs text-gray-300 mb-2"},"色を選択してください",-1)),t("div",ut,[(S(),L(ve,null,Ce(R,q=>{var se;return t("button",{key:q,onClick:s=>U(q),class:ye(["w-8 h-8 rounded-md border-2 transition-all hover:scale-110",((se=v.ruler)==null?void 0:se.color)===q?"border-white":"border-gray-600 hover:border-gray-400"]),style:re({backgroundColor:q}),title:b(q)},null,14,ft)}),64))]),t("div",gt,[t("input",{type:"color",value:((K=v.ruler)==null?void 0:K.color)||"#ff0000",onInput:te,class:"w-full h-8 rounded border border-gray-600 cursor-pointer",title:"カスタムカラー"},null,40,mt),y[7]||(y[7]=t("div",{class:"text-xs text-gray-400 mt-1 text-center"},"カスタムカラー",-1))])])):J("",!0)]),y[11]||(y[11]=t("div",{class:"border-t border-gray-700 my-1"},null,-1)),t("button",{onClick:g,class:"context-menu-item text-red-400 hover:bg-red-600/20"},[ee(w(Me),{size:16}),y[9]||(y[9]=t("span",null,"削除",-1)),y[10]||(y[10]=t("span",{class:"text-xs text-gray-500 ml-auto"},"Del",-1))])])],4)):J("",!0),v.isVisible?(S(),L("div",{key:1,class:"fixed inset-0 z-40",onClick:h,onContextmenu:fe(h,["prevent"])},null,32)):J("",!0)],64)}}}),pt=Ie(ht,[["__scopeId","data-v-8a71526a"]]),xt={class:"relative w-full h-full bg-gray-900 overflow-hidden"},vt={key:0,class:"absolute inset-0 flex items-center justify-center text-gray-500"},yt={class:"text-center"},Rt=ge({__name:"ImageCanvas",setup(k){const e=be(),a=Q(null),{setupCanvas:I,drawImage:f,drawRulers:R,clearCanvas:z,drawTemporaryRuler:N}=Ze();let H=!1,Y=null,U=0,te=!1,b=null,g=null,h=!1,v=null,y=null,F=!1,T=null,K=0,q=!1;const se=Q(null),s=Q(null),o=Q(!1);Ae(()=>{a.value&&(I(a.value),l(),window.addEventListener("resize",l),window.addEventListener("keydown",le),window.addEventListener("keyup",Z))}),Ee(()=>{window.removeEventListener("resize",l),window.removeEventListener("keydown",le),window.removeEventListener("keyup",Z)}),xe(()=>e.image.src,async()=>{if(e.image.src&&a.value){await Le();const i=new Image;i.onload=()=>{m(i),f(i,e.image),R(e.rulers,e.image,e.lockedRatios,e.highlightedRulerIds)},i.src=e.image.src}else z()}),xe(()=>e.rulers,()=>{if(e.hasImage&&a.value){const i=new Image;i.onload=()=>{f(i,e.image),R(e.rulers,e.image,e.lockedRatios,e.highlightedRulerIds)},i.src=e.image.src}},{deep:!0}),xe(()=>[e.image.scale,e.image.offsetX,e.image.offsetY],()=>{if(e.hasImage&&a.value){const i=new Image;i.onload=()=>{f(i,e.image),R(e.rulers,e.image,e.lockedRatios,e.highlightedRulerIds)},i.src=e.image.src}},{deep:!0}),xe(()=>e.lockedRatios,()=>{if(e.hasImage&&a.value){const i=new Image;i.onload=()=>{f(i,e.image),R(e.rulers,e.image,e.lockedRatios,e.highlightedRulerIds)},i.src=e.image.src}},{deep:!0}),xe(()=>e.selectedHistoryId,()=>{if(e.hasImage&&a.value){const i=new Image;i.onload=()=>{f(i,e.image),R(e.rulers,e.image,e.lockedRatios,e.highlightedRulerIds)},i.src=e.image.src}});const l=()=>{if(a.value&&a.value.parentElement){const d=a.value.parentElement.getBoundingClientRect(),C=window.devicePixelRatio||1;a.value.width=d.width*C,a.value.height=d.height*C,a.value.style.width=d.width+"px",a.value.style.height=d.height+"px";const p=a.value.getContext("2d");if(p&&p.scale(C,C),e.hasImage){const u=new Image;u.onload=()=>{f(u,e.image),R(e.rulers,e.image,e.lockedRatios,e.highlightedRulerIds)},u.src=e.image.src}}},m=i=>{if(!a.value)return;const d=a.value.clientWidth,C=a.value.clientHeight,p=d/i.width,u=C/i.height,_=Math.min(p,u)*.9,O=(d-i.width*_)/2,oe=(C-i.height*_)/2;e.setImageData({scale:_,offsetX:O,offsetY:oe})},r=i=>{if(!a.value)return{x:0,y:0};const d=a.value.getBoundingClientRect();return{x:i.clientX-d.left,y:i.clientY-d.top}},x=i=>({x:(i.x-e.image.offsetX)/e.image.scale,y:(i.y-e.image.offsetY)/e.image.scale}),D=i=>{const d=r(i);if(!e.hasImage)return;const C=W(d),p=G(d),u=ne(d);if(i.ctrlKey&&u){e.startInstantComparison(u.id);return}if(C){h=!0,v=C.ruler,y=C.endpoint,e.selectRuler(v.id),e.setDragState(!0,"edit");return}if(p){F=!0,v=p.ruler,T=p.center;const O=x(d);K=Math.atan2(O.y-T.y,O.x-T.x),e.selectRuler(v.id),e.setDragState(!0,"edit");return}if(u){if(e.isInComparisonMode){e.toggleCompareSelection(u.id);return}e.selectRuler(u.id),me(u,{x:i.clientX,y:i.clientY});return}!u&&!C&&!p&&(i.altKey?(te=!0,b=d,g={x:e.image.offsetX,y:e.image.offsetY},e.setDragState(!0,"pan")):e.hasImage&&(H=!0,Y=x(d),e.setDragState(!0,"create")),e.isInComparisonMode||e.clearSelection(),n())},P=i=>{if(!e.hasImage)return;const d=Date.now();if(d-U<16)return;U=d;const C=r(i);if(H&&Y&&e.interactionContext.dragType==="create"){const p=x(C),u=Y,_=new Image;_.onload=()=>{f(_,e.image),R(e.rulers,e.image,e.lockedRatios,e.highlightedRulerIds),N(u,p,e.image)},_.src=e.image.src}else if(te&&b&&g&&e.interactionContext.dragType==="pan"){const p=C.x-b.x,u=C.y-b.y,_=g.x+p,O=g.y+u;e.setImageData({offsetX:_,offsetY:O});const oe=new Image;oe.onload=()=>{f(oe,e.image),R(e.rulers,e.image,e.lockedRatios,e.highlightedRulerIds)},oe.src=e.image.src}else if(h&&v&&y&&e.interactionContext.dragType==="edit"){const p=x(C),u={...v};y==="start"?u.startPoint=p:u.endPoint=p,u.length=Math.sqrt(Math.pow(u.endPoint.x-u.startPoint.x,2)+Math.pow(u.endPoint.y-u.startPoint.y,2)),u.angle=Math.atan2(u.endPoint.y-u.startPoint.y,u.endPoint.x-u.startPoint.x)*180/Math.PI,e.updateRuler(v.id,u),v=u;const _=new Image;_.onload=()=>{f(_,e.image),R(e.rulers,e.image,e.lockedRatios,e.highlightedRulerIds)},_.src=e.image.src}else if(F&&v&&T&&e.interactionContext.dragType==="edit"){const p=x(C),_=Math.atan2(p.y-T.y,p.x-T.x)-K,O=v.length/2,V=Math.atan2(v.endPoint.y-v.startPoint.y,v.endPoint.x-v.startPoint.x)+_,ae={...v};ae.startPoint={x:T.x-Math.cos(V)*O,y:T.y-Math.sin(V)*O},ae.endPoint={x:T.x+Math.cos(V)*O,y:T.y+Math.sin(V)*O},ae.angle=V*180/Math.PI,e.updateRuler(v.id,ae);const ie=new Image;ie.onload=()=>{f(ie,e.image),R(e.rulers,e.image,e.lockedRatios,e.highlightedRulerIds)},ie.src=e.image.src}},$=i=>{if(H&&Y&&e.hasImage&&e.interactionContext.dragType==="create"){const d=r(i),C=x(d);if(Math.abs(C.x-Y.x)>5||Math.abs(C.y-Y.y)>5){const p=Math.sqrt(Math.pow(C.x-Y.x,2)+Math.pow(C.y-Y.y,2)),u=Math.atan2(C.y-Y.y,C.x-Y.x)*180/Math.PI,_=4,O=Je(_),oe={id:`ruler-${Date.now()}`,startPoint:Y,endPoint:C,color:O,length:p,angle:u,isSelected:!1,isCompareSelected:!1,divisions:_};e.addRuler(oe);const V=new Image;V.onload=()=>{f(V,e.image),R(e.rulers,e.image,e.lockedRatios,e.highlightedRulerIds)},V.src=e.image.src}}H=!1,Y=null,te=!1,b=null,g=null,h=!1,F=!1,v=null,y=null,T=null,K=0,e.setDragState(!1,null)},B=i=>{if(!e.hasImage)return;const d=r(i),C=i.deltaY>0?.9:1.1,p=Math.max(.1,Math.min(10,e.image.scale*C)),u=d.x-(d.x-e.image.offsetX)*(p/e.image.scale),_=d.y-(d.y-e.image.offsetY)*(p/e.image.scale);e.setImageData({scale:p,offsetX:u,offsetY:_});const O=new Image;O.onload=()=>{f(O,e.image),R(e.rulers,e.image,e.lockedRatios,e.highlightedRulerIds)},O.src=e.image.src},W=i=>{const d=x(i),C=15/e.image.scale;for(const p of e.rulers){if(Math.sqrt(Math.pow(d.x-p.startPoint.x,2)+Math.pow(d.y-p.startPoint.y,2))<=C)return{ruler:p,endpoint:"start"};if(Math.sqrt(Math.pow(d.x-p.endPoint.x,2)+Math.pow(d.y-p.endPoint.y,2))<=C)return{ruler:p,endpoint:"end"}}return null},G=i=>{for(const d of e.rulers){if(!d.isSelected)continue;const C={x:d.startPoint.x*e.image.scale+e.image.offsetX,y:d.startPoint.y*e.image.scale+e.image.offsetY},p={x:d.endPoint.x*e.image.scale+e.image.offsetX,y:d.endPoint.y*e.image.scale+e.image.offsetY},u={x:(C.x+p.x)/2,y:(C.y+p.y)/2},O=Math.atan2(p.y-C.y,p.x-C.x)+Math.PI/2,oe=e.lockedRatios.some(Re=>Re.rulerA.id===d.id||Re.rulerB.id===d.id),V=30,ae=oe?1:-1,ie=u.x+Math.cos(O)*V*ae,pe=u.y+Math.sin(O)*V*ae;if(Math.sqrt(Math.pow(i.x-ie,2)+Math.pow(i.y-pe,2))<=12){const Re={x:(d.startPoint.x+d.endPoint.x)/2,y:(d.startPoint.y+d.endPoint.y)/2};return{ruler:d,center:Re,handlePos:{x:ie,y:pe}}}}return null},ne=i=>{const d=x(i),C=10/e.image.scale,p=e.rulers.map(u=>{const _=de(d,u);return{ruler:u,distance:_}}).sort((u,_)=>u.distance-_.distance);return p.length>0&&p[0].distance<=C?p[0].ruler:null},de=(i,d)=>{const C=i.x-d.startPoint.x,p=i.y-d.startPoint.y,u=d.endPoint.x-d.startPoint.x,_=d.endPoint.y-d.startPoint.y,O=C*u+p*_,oe=u*u+_*_;if(oe===0)return Math.sqrt(C*C+p*p);let V=O/oe,ae,ie;V<0?(ae=d.startPoint.x,ie=d.startPoint.y):V>1?(ae=d.endPoint.x,ie=d.endPoint.y):(ae=d.startPoint.x+V*u,ie=d.startPoint.y+V*_);const pe=i.x-ae,we=i.y-ie;return Math.sqrt(pe*pe+we*we)},me=(i,d)=>{se.value=i,s.value=d,o.value=!0},n=()=>{o.value=!1,se.value=null,s.value=null},c=i=>{e.selectRuler(i)},M=i=>{e.startInstantComparison(i)},A=(i,d)=>{e.updateRuler(i,{color:d})},X=i=>{e.removeRuler(i)},le=i=>{i.altKey&&!q&&(q=!0)},Z=i=>{!i.altKey&&q&&(q=!1)},he=()=>{if(!e.hasImage)return"cursor-default";const i=e.interactionContext;if(i.isDragging)switch(i.dragType){case"create":return"cursor-crosshair";case"edit":return F?"cursor-grabbing":"cursor-move";case"pan":return"cursor-grabbing";default:return"cursor-default"}switch(i.mode){case"ruler_selected":return"cursor-pointer";case"comparison":return"cursor-pointer";case"idle":default:return q?"cursor-grab":"cursor-crosshair"}};return(i,d)=>(S(),L("div",xt,[t("canvas",{ref_key:"canvasRef",ref:a,class:ye(["absolute inset-0 w-full h-full",he()]),onMousedown:D,onMousemove:P,onMouseup:$,onWheel:fe(B,["prevent"])},null,34),ee(at),ee(pt,{ruler:se.value,position:s.value,"is-visible":o.value,onEdit:c,onCompare:M,onChangeColor:A,onDelete:X,onClose:n},null,8,["ruler","position","is-visible"]),w(e).hasImage?J("",!0):(S(),L("div",vt,[t("div",yt,[ee(w(Fe),{size:48,class:"mx-auto mb-4 text-gray-500"}),d[0]||(d[0]=t("p",{class:"text-lg text-gray-300"},"画像を開いて測定を開始",-1)),d[1]||(d[1]=t("p",{class:"text-sm mt-2 text-gray-400"},"上部の「画像を開く」ボタンから画像ファイルを選択してください",-1))])]))]))}}),Ct={class:"property-panel bg-gray-800 border-gray-700 text-gray-100"},bt={class:"space-y-4"},wt={key:0,class:"space-y-2"},_t={class:"text-xs text-gray-400 space-y-1"},Mt={key:1,class:"space-y-3"},It={class:"space-y-2"},kt={class:"text-xs text-gray-400"},Pt={class:"text-xs text-gray-400"},St={class:"flex items-center space-x-2"},Tt=["value"],At={key:2,class:"space-y-3"},Et={key:0,class:"text-xs text-gray-500"},Lt={key:1,class:"space-y-2"},Dt={class:"text-xs text-gray-400"},$t={class:"text-xs text-gray-400"},Bt={key:2,class:"space-y-2"},Xt={class:"text-xs text-gray-400"},Yt={class:"text-xs text-gray-400"},Ot={class:"text-xs text-gray-400"},Ht={class:"text-xs text-gray-400"},Wt={class:"text-xs text-gray-400 font-medium"},zt={class:"text-xs text-gray-400"},Nt={key:3,class:"space-y-3"},Ft={class:"space-y-2"},qt={class:"text-xs text-gray-400"},Ut={class:"text-xs text-gray-400"},Vt={class:"text-xs text-gray-400"},jt={class:"text-xs text-gray-400"},Kt={class:"text-xs text-gray-400 font-medium"},Gt={class:"text-xs text-gray-400"},Zt={key:4,class:"space-y-3"},Jt={class:"flex items-center justify-between"},Qt={key:0,class:"text-xs text-gray-500"},es={class:"max-h-32 overflow-y-auto space-y-1"},ts=["onClick"],ss={class:"flex items-center justify-between"},os={class:"flex items-center space-x-2"},ns={class:"text-gray-300"},as={class:"flex items-center space-x-1"},rs={key:0,class:"text-blue-400 text-xs"},ls={key:1,class:"text-orange-400 text-xs"},is={class:"flex items-center justify-between mt-1"},cs={class:"text-xs text-gray-500"},ds=["onClick","disabled"],us={class:"text-xs text-gray-400 min-w-[2rem] text-center"},fs=["onClick","disabled"],gs={key:5,class:"space-y-3"},ms={class:"max-h-32 overflow-y-auto space-y-1"},hs=["onClick"],ps={class:"flex items-center justify-between"},xs={class:"flex items-center space-x-2"},vs={class:"text-gray-300 font-medium"},ys={class:"flex items-center space-x-1"},Rs=["onClick"],Cs={class:"flex items-center justify-between mt-1 text-gray-500"},bs={class:"flex items-center space-x-1"},ws={class:"text-xs"},_s=ge({__name:"PropertyPanel",setup(k){const e=be(),a=ce(()=>e.selectedHistoryId&&e.lockedRatios.find(b=>b.id===e.selectedHistoryId)||null),I=b=>{const g=b.target;e.selectedRuler&&e.updateRuler(e.selectedRuler.id,{color:g.value})},f=(b,g)=>{const h=e.rulers.find(v=>v.id===b);if(h){const y=(h.divisions||4)+g;y>=Qe&&y<=et&&e.updateRuler(b,{divisions:y})}},R=()=>{e.selectedRuler&&e.removeRuler(e.selectedRuler.id)},z=b=>{e.isInComparisonMode?e.toggleCompareSelection(b):e.selectRuler(b)},N=b=>{let g=1,h=1,v=Math.abs(b-1);for(let o=1;o<=10;o++)for(let l=1;l<=10;l++)if((o+l)%2===0||(o+l)%3===0){const m=o/l,r=Math.abs(b-m);r<v&&(v=r,g=o,h=l)}const y=(o,l)=>{for(;l!==0;){const m=l;l=o%l,o=m}return o},F=g/y(g,h),T=h/y(g,h),K=T*b,q=T,se=K%1===0?K.toString():K.toFixed(2),s=q%1===0?q.toString():q.toFixed(2);return{simpleRatio:`${F}:${T}`,actualRatio:`${se}:${s}`}},H=()=>{const b=e.compareRulers;if(b.length===2){const g=b[0].length/b[1].length;return N(g).simpleRatio}return"---"},Y=()=>{const b=e.compareRulers;if(b.length===2){const g=b[0].length/b[1].length;return N(g).actualRatio}return"---"},U=b=>{e.removeLock(b)},te=b=>{e.selectHistory(b)};return(b,g)=>(S(),L("div",Ct,[t("div",bt,[g[13]||(g[13]=t("div",{class:"text-lg font-semibold text-gray-100"}," プロパティ ",-1)),w(e).hasImage?(S(),L("div",wt,[g[1]||(g[1]=t("h3",{class:"text-sm font-medium text-gray-300"},"画像情報",-1)),t("div",_t,[t("div",null,"サイズ: "+E(w(e).image.width)+" × "+E(w(e).image.height),1),t("div",null,"倍率: "+E(Math.round(w(e).image.scale*100))+"%",1)])])):J("",!0),w(e).selectedRuler?(S(),L("div",Mt,[g[5]||(g[5]=t("h3",{class:"text-sm font-medium text-gray-300"},"選択中",-1)),t("div",It,[t("div",kt," 長さ: "+E(Math.round(w(e).selectedRuler.length))+"px ",1),t("div",Pt," 角度: "+E(Math.round(w(e).selectedRuler.angle))+"° ",1),g[4]||(g[4]=t("div",{class:"text-xs text-gray-500 bg-gray-700/50 p-2 rounded"},[t("div",null,"• 端点をドラッグ: サイズ変更"),t("div",null,"• 回転ハンドル をドラッグ: 回転"),t("div",{class:"text-xs text-gray-600 mt-1"},"（回転ハンドルは選択時に表示）")],-1)),t("div",St,[g[2]||(g[2]=t("label",{class:"text-xs text-gray-400"},"色:",-1)),t("input",{type:"color",value:w(e).selectedRuler.color,onChange:I,class:"w-6 h-6 rounded border border-gray-600 bg-gray-700"},null,40,Tt)]),t("button",{onClick:R,class:"w-full mt-3 px-3 py-2 bg-red-600 text-white text-sm rounded hover:bg-red-700 transition-colors"},[ee(w(Me),{size:14,class:"inline mr-1"}),g[3]||(g[3]=ue(" 削除 "))])])])):J("",!0),w(e).isInComparisonMode?(S(),L("div",At,[g[7]||(g[7]=t("h3",{class:"text-sm font-medium text-gray-300"},"比較モード",-1)),w(e).compareRulers.length===0?(S(),L("div",Et," 2つの定規をクリックして選択してください ")):w(e).compareRulers.length===1?(S(),L("div",Lt,[t("div",Dt,[ue(" 選択中: "+E(Math.round(w(e).compareRulers[0].length))+"px ",1),t("div",{class:"w-3 h-3 rounded inline-block ml-2",style:re({backgroundColor:w(e).compareRulers[0].color})},null,4)]),t("div",$t," 角度: "+E(Math.round(w(e).compareRulers[0].angle))+"° ",1),g[6]||(g[6]=t("div",{class:"text-xs text-gray-500"}," もう1つの定規を選択してください ",-1))])):w(e).compareRulers.length===2?(S(),L("div",Bt,[t("div",Xt,[ue(" 定規A: "+E(Math.round(w(e).compareRulers[0].length))+"px ",1),t("div",{class:"w-3 h-3 rounded inline-block ml-2",style:re({backgroundColor:w(e).compareRulers[0].color})},null,4)]),t("div",Yt," 角度A: "+E(Math.round(w(e).compareRulers[0].angle))+"° ",1),t("div",Ot,[ue(" 定規B: "+E(Math.round(w(e).compareRulers[1].length))+"px ",1),t("div",{class:"w-3 h-3 rounded inline-block ml-2",style:re({backgroundColor:w(e).compareRulers[1].color})},null,4)]),t("div",Ht," 角度B: "+E(Math.round(w(e).compareRulers[1].angle))+"° ",1),t("div",Wt," 簡易比率: "+E(H()),1),t("div",zt," 実際の比率: "+E(Y()),1)])):J("",!0)])):a.value?(S(),L("div",Nt,[g[8]||(g[8]=t("h3",{class:"text-sm font-medium text-gray-300"},"選択された比率履歴",-1)),t("div",Ft,[t("div",qt,[ue(" 定規A: "+E(Math.round(a.value.rulerA.length))+"px ",1),t("div",{class:"w-3 h-3 rounded inline-block ml-2",style:re({backgroundColor:a.value.rulerA.color})},null,4)]),t("div",Ut," 角度A: "+E(Math.round(a.value.rulerA.angle))+"° ",1),t("div",Vt,[ue(" 定規B: "+E(Math.round(a.value.rulerB.length))+"px ",1),t("div",{class:"w-3 h-3 rounded inline-block ml-2",style:re({backgroundColor:a.value.rulerB.color})},null,4)]),t("div",jt," 角度B: "+E(Math.round(a.value.rulerB.angle))+"° ",1),t("div",Kt," 簡易比率: "+E(a.value.simpleRatio),1),t("div",Gt," 実際の比率: "+E(a.value.actualRatio),1)])])):J("",!0),w(e).rulers.length>0?(S(),L("div",Zt,[t("div",Jt,[g[9]||(g[9]=t("h3",{class:"text-sm font-medium text-gray-300"},"定規一覧",-1)),w(e).isInComparisonMode?(S(),L("span",Qt," クリックで比較選択 ")):J("",!0)]),t("div",es,[(S(!0),L(ve,null,Ce(w(e).rulers,h=>(S(),L("div",{key:h.id,class:ye(["p-2 rounded border text-xs cursor-pointer hover:bg-gray-700 transition-colors relative",{"border-blue-400 bg-blue-900/50":h.isSelected},{"border-orange-400 bg-orange-900/50":h.isCompareSelected},{"border-gray-600 bg-gray-700/50":!h.isSelected&&!h.isCompareSelected}]),onClick:v=>z(h.id)},[t("div",ss,[t("div",os,[t("div",{class:"w-3 h-3 rounded",style:re({backgroundColor:h.color})},null,4),t("span",ns,E(Math.round(h.length))+"px",1)]),t("div",as,[h.isSelected?(S(),L("span",rs,"選択中")):J("",!0),h.isCompareSelected?(S(),L("span",ls,"比較中")):J("",!0)])]),t("div",is,[t("div",cs,E(Math.round(h.angle))+"° ",1),t("div",{class:"flex items-center space-x-1",onClick:g[0]||(g[0]=fe(()=>{},["stop"]))},[t("button",{onClick:v=>f(h.id,-1),disabled:(h.divisions||4)<=2,class:"w-5 h-5 bg-gray-600 text-white text-xs rounded hover:bg-gray-500 disabled:bg-gray-800 disabled:text-gray-600 transition-colors"}," - ",8,ds),t("span",us,E(h.divisions||4),1),t("button",{onClick:v=>f(h.id,1),disabled:(h.divisions||4)>=10,class:"w-5 h-5 bg-gray-600 text-white text-xs rounded hover:bg-gray-500 disabled:bg-gray-800 disabled:text-gray-600 transition-colors"}," + ",8,fs)])])],10,ts))),128))])])):J("",!0),w(e).lockedRatios.length>0?(S(),L("div",gs,[g[12]||(g[12]=t("h3",{class:"text-sm font-medium text-gray-300"},"比率履歴",-1)),t("div",ms,[(S(!0),L(ve,null,Ce(w(e).lockedRatios,h=>(S(),L("div",{key:h.id,class:ye(["p-2 rounded border text-xs cursor-pointer transition-colors group",w(e).selectedHistoryId===h.id?"border-yellow-400 bg-yellow-900/30":"border-gray-600 bg-gray-700/50 hover:bg-gray-700"]),onClick:v=>te(h.id)},[t("div",ps,[t("div",xs,[t("div",{class:"w-3 h-3 rounded",style:re({backgroundColor:h.color})},null,4),t("span",vs,E(h.simpleRatio),1),g[10]||(g[10]=t("span",{class:"text-xs text-gray-500"},"比率",-1))]),t("div",ys,[t("button",{onClick:fe(v=>U(h.id),["stop"]),class:"text-red-400 hover:text-red-300 p-1 opacity-0 group-hover:opacity-100 transition-opacity",title:"履歴から削除"},[ee(w(qe),{size:12})],8,Rs)])]),t("div",Cs,[t("div",bs,[t("div",{class:"w-2 h-2 rounded",style:re({backgroundColor:h.rulerA.color})},null,4),t("span",null,E(Math.round(h.rulerA.length))+"px",1),g[11]||(g[11]=t("span",{class:"mx-1"},":",-1)),t("div",{class:"w-2 h-2 rounded",style:re({backgroundColor:h.rulerB.color})},null,4),t("span",null,E(Math.round(h.rulerB.length))+"px",1)]),t("span",ws,E(h.actualRatio),1)])],10,hs))),128))])])):J("",!0)])]))}}),Ms={class:"flex flex-col h-screen bg-gray-900"},Is={class:"flex flex-1 min-h-0"},ks={class:"flex-1 min-w-0"},Ps=ge({__name:"App",setup(k){return(e,a)=>(S(),L("div",Ms,[ee(Ge),t("div",Is,[t("div",ks,[ee(Rt)]),ee(_s)])]))}}),ke=De(Ps),Ss=$e();ke.use(Ss);ke.mount("#app");
